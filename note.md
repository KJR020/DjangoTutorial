# 学習ノート

- [学習ノート](#学習ノート)
  - [はじめてのビュー作成](#はじめてのビュー作成)
    - [path関数](#path関数)
    - [Databaseの設定](#databaseの設定)
    - [migrate](#migrate)
    - [モデルの作成](#モデルの作成)
  - [初めてのDjangoアプリ作成、その3](#初めてのdjangoアプリ作成その3)
    - [オーバービュー](#オーバービュー)
    - [もっとビューを書いてみる](#もっとビューを書いてみる)
    - [実際に動作するビューを書く](#実際に動作するビューを書く)
    - [ショートカット: render()](#ショートカット-render)
    - [404 エラーの送出](#404-エラーの送出)
    - [ショートカット: get\_object\_or\_404()](#ショートカット-get_object_or_404)
    - [テンプレートシステムを使う](#テンプレートシステムを使う)
    - [テンプレート内のハードコードされたURLを削除](#テンプレート内のハードコードされたurlを削除)
    - [URL 名の名前空間](#url-名の名前空間)
  - [はじめての Django アプリ作成、その 4](#はじめての-django-アプリ作成その-4)
    - [簡単なフォームを書く](#簡単なフォームを書く)
    - [汎用ビューを使う: コードが少ないのはいいことだ](#汎用ビューを使う-コードが少ないのはいいことだ)
    - [URLconf の修正](#urlconf-の修正)
    - [views の修正](#views-の修正)
  - [参考](#参考)


最初に仮想環境を構築

`python -m venv .venv`

`pip install django`

## はじめてのビュー作成

### path関数

- 4つの引数を取る。`route`と`view`は必須。`kwargs`, `name`はoptional
- route: URLパターンを含む文字列。`urlpatterns`のパターンから始まる。リストを順に下から参照し、URLと一致するものを探す。
- view: マッチする正規表現を見つけると`view`関数が呼び出される。  
その際は、`HttpRequest`オブジェクトを第一引数。  
キーワード引数として、`route`からキャプチャされた値を渡す。
- kwargs: 任意のキーワード引数を辞書としてビューにわたす。
- name: urlに名前をつけておくと、Djangoのどこからでも参照できるらしい。便利そう。

### Databaseの設定

### migrate

migrateはバックエンドとなる。データベースの初期設定。テーブルの作成を行う。

>migrate コマンドは INSTALLED_APPS の設定を参照するとともに、 mysite/settings.py ファイルのデータベース設定に従って必要なすべてのデータベースのテーブルを作成します。このデータベースマイグレーションはアプリと共に配布されます (これらについては後ほどカバーします)。マイグレーションを実施するたび、メッセージを見ることになります。もしこれに興味を引かれたら、Djangoが作成したテーブルを表示するために、コマンドラインクライアントであなたのデータベースの種類に合わせて \dt (PostgreSQL)、SHOW TABLES; (MySQL)、 .tables (SQLite)、もしくは SELECT TABLE_NAME FROM USER_TABLES; (Oracle) とタイプしてみましょう。

SQLite以外のDBを使用する場合は、バインディングをインストールする必要がある。  
一旦SQLiteでチュートリアルを進めて、後ほど置き換える形で学習を進める

コマンド

```bash
python manage.py migrate
```

### モデルの作成

モデルは本質的に、データベースのレイアウトと、それに付随するメタデータらしい

設計思想として、マイグレーションをモデルに含めているらしい。  
Ruby On Railsとの設計思想の違いはどこから生まれているのか気になった。

>設計思想
>
>モデルは、手持ちのデータに対する唯一無二の決定的なソースです。モデルには自分が格納したいデータにとって必要不可欠なフィー ルドと、そのデータの挙動を収めます。 Django は DRY 則 に従っています。 Django のモデルの目的は、ただ一つの場所でデータモデルを定義し、そこから自動的にデータを取り出すことにあります。
>
>これはマイグレーションを含みます - たとえば、Ruby On Rails と違って、マイグレーションは完全にモデルのファイルから生成されます。マイグレーションは本質的には単なる履歴です。Django はデータベーススキーマをアップデートしながら履歴を進んでいき、現在のモデルに合致させることができます。

modelは以下のように、models.pyを編集する。

```python
from django.db import models


class Question(models.Model):
    question_text = models.ChatField(max_length=200)
    pub_date = models.DateTimeField("date published")


class Choice(models.Model):
    question = models.ForeignKey()
    choice = models.CharField(max_length=200)
    votes = models.IntegerChoices(default=0)
```

モデルはdjango.db.models.Modelのサブクラスとして作成する。  
各クラスは、クラス変数としてDBのテーブル列(フィールド)と対応する。  
モデル定義から自動的にテーブルスキーマを生成してくれる。

## 初めてのDjangoアプリ作成、その3

### オーバービュー

- ビューとは、特定の機能を提供するWEBページの型である
- ページそれぞれ各々のテンプレートがある
- Djangoは返すビューを、リクエストされたURLから決定する
- URLパターンは下記のようなURLを一般化したもの  
  ex) `/newarchive/<year>/<month>/`
- DjangoはURLからビュー取得する際に、URLconfを仕様する

### もっとビューを書いてみる

- `/polls/34/`をリクエストすると、`ROOT_URLCONF`に指定された`mysite.urls`をロードする
- `urlspatterns`という変数を探し、順番にパターンを走査する
- `:`はコンバータとパターン名を区切る

### 実際に動作するビューを書く

### ショートカット: render()

- 引数として、requestオブジェクト、テンプレート名(str)、コンテキスト(辞書)
- `render`関数を使うと、テンプレートを指定のコンテキストでレンダリングし、HttpResponseオブジェクトを返す

### 404 エラーの送出

- リクエストしたIDをもつ質問が存在しないとき、Http404を返す
- 一般的化すると、リクエストしたURLに該当するオブジェクトが存在しないといった状況

### ショートカット: get_object_or_404()

- 404エラーを返すためのヘルパー関数, HttpResponseもしくはHttp404を返す
- 効率的にエラー処理をかける

### テンプレートシステムを使う

### テンプレート内のハードコードされたURLを削除

### URL 名の名前空間

## はじめての Django アプリ作成、その 4

### 簡単なフォームを書く

### 汎用ビューを使う: コードが少ないのはいいことだ

### URLconf の修正

### views の修正

## 参考

- https://qiita.com/muranakar/items/20a7927ffa63a5ca226a  
コミットメッセージのprefixの付け方
